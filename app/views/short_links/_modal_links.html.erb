<%= turbo_frame_tag "my_links_frame" do %>
  <% if @short_links.any? %>
    <ul class="list-group">
      <% @short_links.each do |link| %>
        <li id="<%= dom_id(link) %>" class="list-group-item d-flex justify-content-between align-items-center gap-3">
          <div class="flex-grow-1">
            <small class="text-muted d-block mb-1">
              <%= link.original_url.truncate(25) %>
            </small>

            <div>
              <strong class="d-block text-primary">
                <%= link_to redirect_short_url(link.short_code), redirect_short_url(link.short_code), target: "_blank" %>
              </strong>

              <div class="d-flex gap-3 mt-1 align-items-center" style="font-size: 0.75rem;">
                <span class="text-muted">
                  <i class="bi bi-bar-chart-fill me-1"></i>
                  <%= pluralize(link.click_count, 'click') %>
                </span>

                <span class="text-muted">
                  <i class="bi bi-box-arrow-in-up-right me-1"></i>
                  <%= link.created_via.titleize %>
                </span>

                <span class="text-muted"
                      data-controller="tooltip"
                      data-bs-toggle="tooltip"
                      data-bs-title="Created at <%= link.created_at.strftime('%Y-%m-%d %H:%M') %>"
                      style="cursor: help;">
                  <i class="bi bi-clock-history me-1"></i>
                  <%= link.days_alive.zero? ? "Today" : "#{link.days_alive}d" %>
                </span>
              </div>
            </div>
          </div>

          <div class="d-flex flex-shrink-0 gap-2 align-self-start">
            <button class="btn btn-sm btn-outline-secondary"
                    data-controller="clipboard"
                    data-action="clipboard#copy"
                    data-clipboard-text="<%= redirect_short_url(link.short_code) %>">
              <span class="clipboard-label">Copy</span>
            </button>

            <%= button_to short_link_path(link),
                  method: :delete,
                  data: { turbo_confirm: "Are you sure you want to remove this short link?" },
                  class: "btn btn-sm btn-outline-danger" do %>
              Remove
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>

    <div class="d-flex justify-content-center mt-4">
      <%== pagy_bootstrap_nav(@pagy,
            link_extra: 'data-turbo-frame="my_links_frame"',
            steps: { 0 => [1,2,2,1] }) %>
    </div>

    <style>
      .pagy-bootstrap .pagination {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
      }

      .pagy-bootstrap .page-link {
        padding: 0.25rem 0.5rem;
      }
    </style>

  <% else %>
    <div class="text-center py-4">
      <img src="https://cdn-icons-png.flaticon.com/512/463/463574.png"
           alt="No links"
           width="72"
           height="72"
           class="mb-3 opacity-75" />
      <h6 class="fw-semibold text-muted">No short links found</h6>
      <p class="small text-secondary mb-3">You havenâ€™t created any short links yet. Start by entering a URL below.</p>
    </div>
  <% end %>
<% end %>
